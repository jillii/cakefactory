function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var a=document.createElement("div");return a.appendChild(document.createTextNode(e)),a.innerHTML}$(function(){var e=new Firebase("http://cfactoryboston.firebaseio.com/").child(slugify(window.location.pathname)),a=$("#error--no-name"),s=$("#error--no-message"),t=$("#error--no-reply"),n=$(".popup-container"),r="anonymous";e.on("child_added",function(e){var a=e.val(),s=escapeHtml(a.name),t=escapeHtml(a.message),n=moment(a.postedAt).fromNow(),r=slugify(a.postedAt),o=a.reply_to,i=a.indent,l=5*i,d="$(this).toggleClass('active').next().toggleClass('hidden')";0==o?$(".comments").prepend('<div id="'+r+'" class="comment" data-indent="0"><h4>'+s+":</h4><span>&nbsp;"+t+'</span><p class="date">'+n+'</p><a href="#stream" class="reply-to" onclick="'+d+'">reply</a><div class="drawer hidden"><form name="reply"><textarea rows="1" class="reply-message" placeholder="write a response"></textarea><input class="btn" type="submit" value="Reply"></form><div class="error hidden" id="error--no-reply">Please write a message</div></div></div>'):$("#"+o).append('<div id="'+r+'" class="comment reply" data-indent="'+i+'" style="padding-left:'+l+'px"><h4>'+s+":</h4><span>&nbsp;"+t+'</span><p class="date">'+n+'</p><a href="#stream" class="reply-to" onclick="'+d+'">reply</a><div class="drawer hidden"><form name="reply"><textarea rows="1" class="reply-message" placeholder="write a response"></textarea><input class="btn" type="submit" value="Reply"></form><div class="error hidden" id="error--no-reply">Please write a message</div></div></div>')}),$("#join-chat").click(function(){n.addClass("active")}),$("#submit-name").click(function(){if(!((r=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),n.append('<p class="center-hor-ver">hi '+r+"</p>"),setTimeout(function(){n.removeClass("active"),$(".comments").addClass("active"),$(".comment-form--container").removeClass("hidden")},500),r;a.removeClass("hidden")}),$("#comment").submit(function(){var a=$("#message").val();if(!(a.length<=0))return e.push().set({name:r,message:a,postedAt:Firebase.ServerValue.TIMESTAMP,reply_to:!1,indent:0}),$("input[type=text], textarea").val(""),!1;s.removeClass("hidden")}),$(document).on("submit",'form[name="reply"]',function(){var a=$(this).find(".reply-message").val(),s=$(this).parents(".comment"),n=s.attr("id"),o=parseInt(s.data("indent"))+1;if(console.log(a),!(a.length<=0)){var i=e.push();return console.log("step 2"),i.set({name:r,message:a,postedAt:Firebase.ServerValue.TIMESTAMP,reply_to:n,indent:o}),console.log("step 3"),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1}console.log("actually this"),t.removeClass("hidden")}),$("#message").on("keyup",function(){s.hasClass("hidden")||s.addClass("hidden")}),$(".reply-message").on("keyup",function(){t.hasClass("hidden")||t.addClass("hidden")})});