function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var a=document.createElement("div");return a.appendChild(document.createTextNode(e)),a.innerHTML}$(".reply").click(function(){console.log($(this)),$(this).next().removeClass("hidden")}),$(function(){var e=new Firebase("http://cfactoryboston.firebaseio.com/").child(slugify(window.location.pathname)),a=$("#error--no-name"),n=$("#error--no-message"),s=$("#error--no-reply"),t=$(".popup-container");e.on("child_added",function(e){var a=e.val(),n=escapeHtml(a.name),s=escapeHtml(a.message),t=moment(a.postedAt).fromNow(),r=a.reply_to;0==r?$(".comments").prepend('<div id="'+t+'" class="comment"><h4>'+n+":</h4><span>&nbsp;"+s+'</span><p class="date">'+t+'</p><a href="#stream" class="reply">reply</a><form id="reply" class="hidden reply--container"><input type="text" id="reply-message"><input type="submit" class="btn" id="reply"></form>\x3c!--form container--\x3e</div>\x3c!-- comment --\x3e'):$("#"+r).after('<div class="comment reply"><h4>'+n+":</h4><span>&nbsp;"+s+'</span><p class="date">'+t+'</p><a href="#stream" class="reply">reply</a>')}),$("#join-chat").click(function(){t.addClass("active")}),$("#submit-name").click(function(){if($name=$("#chat-name").val(),!($name.length<=0))return t.removeClass("active"),$("#join-chat").addClass("hidden"),$(".comment-form--container").removeClass("hidden").find("h3").append(" "+$name),$name;a.removeClass("hidden")}),$("#comment").submit(function(){if(!($("#message").val().length<=0))return e.push().set({name:$name,message:$("#message").val(),md5Email:md5($("#email").val()),postedAt:Firebase.ServerValue.TIMESTAMP,likes:0,reply_to:!1}),$("input[type=text], textarea").val(""),!1;n.removeClass("hidden")}),$("#reply").submit(function(){var a=$("#reply-message").val(),n=$(this).parents(".comment").attr("id");if(!(a.length<=0))return e.push().set({name:$name,message:$("#message").val(),md5Email:md5($("#email").val()),postedAt:Firebase.ServerValue.TIMESTAMP,likes:0,reply_to:n}),$("input[type=text], textarea").val(""),!1;s.removeClass("hidden")}),$("#message").on("keyup",function(){n.hasClass("hidden")||n.addClass("hidden")}),$("#reply-message").on("keyup",function(){s.hasClass("hidden")||s.addClass("hidden")})});