function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var s=document.createElement("div");return s.innerHTML=e,s.textContent||s.innerText||""}$(function(){var e=firebase.database().ref().child(slugify(window.location.pathname)),s=$("#error--no-name"),a=$("#error--no-message"),t=$(".popup-container"),i="anonymous";e.on("child_added",function(e){var s=e.val(),a=escapeHtml(s.name),t=escapeHtml(s.message),i=moment(s.postedAt).fromNow(),r=e.key,n=s.reply_to,l=s.likes,c=s.likers,d=s.cakes,o=s.cakers,p=s.reply_name,h="$(this).toggleClass('active').parent().next().toggleClass('hidden')";0==n?$(".comments").prepend('<div id="'+r+'" class="comment"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+i+'</p><div class="cake-container"><span class="shortcakes">'+d+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+o+'</div></div><div class="likes-container"><span class="likes">'+l+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div></div><a href="#stream" class="reply-to" onclick="'+h+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn hidden" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>'):$("#"+n).find(".responses").first().append('<div id="'+r+'" class="comment reply" data-replyto="'+p+'"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+i+'</p><div class="cake-container"><span class="shortcakes">'+d+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+o+'</div></div><div class="likes-container"><span class="likes">'+l+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div></div><a href="#stream" class="reply-to" onclick="'+h+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn hidden" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>')}),e.on("child_changed",function(e){var s=e.val(),a=s.likes,t=s.likers,i=$("#"+e.key),r=s.cakes,n=s.cakers,l=s.reply_name;i.find(".likes").first().html(a).find(".ppl-who-have-liked.like-reacts").first().html(t).find(".shortcakes").first().html(r).find(".ppl-who-have-liked.cake-reacts").first().html(n).data("replyto-name",l)}),$("#join-chat").click(function(){t.addClass("active")}),$("#submit-name").click(function(){if(!((i=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),t.append('<p class="center-hor-ver">hi '+i+"</p>"),setTimeout(function(){t.removeClass("active"),$(".comments").addClass("active"),$(".comment-form--container").removeClass("hidden")},500),i;s.removeClass("hidden")}),$("#chat-name").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#submit-name").click())}),$("#comment").submit(function(s){s.preventDefault();var t=$("#message").val();if(!(t.length<=0))return e.push().set({name:i,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:!1,reply_name:""}),$("input[type=text], textarea").val(""),!1;a.removeClass("hidden")}),$("#message").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("keyup",".reply-message",function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("submit",'form[name="reply"]',function(){var s=$(this).find(".reply-message").val(),a=$(this).parents(".comment").first(),t=a.attr("id"),r=a.find("h4").text().split(":")[0],n=$(this).find("#error--no-reply");if(!(s.length<=0))return e.push().set({name:i,message:s,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:t,reply_name:"Replying to: "+r}),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1;n.removeClass("hidden")}),$("#message").on("keyup",function(){a.hasClass("hidden")||a.addClass("hidden")}),$("#stream").on("keyup",".reply-message",function(){$error=$(this).parent().find("#error--no-reply"),$error.hasClass("hidden")||$error.addClass("hidden")}),$("#stream").on("click",".like",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),r=t.attr("id"),n=e.child(r),l=parseInt(a.prev().html()),c=t.find(".ppl-who-have-liked.like-reacts").html()+"<br>"+i;return n&&(n.update({likes:l+1,likers:c}),a.addClass("clicked")),n}}),$("#stream").on("click",".shortcake",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),r=t.attr("id"),n=e.child(r),l=parseInt(a.prev().html()),c=t.find(".ppl-who-have-liked.cake-reacts").html()+"<br>"+i;return n&&(n.update({cakes:l+1,cakers:c}),a.addClass("clicked")),n}}),$("#stream").on({mouseenter:function(e){ppl_who_have_liked=$(e.currentTarget).next().next(),position_y=e.clientY,position_x=e.clientX,ppl_who_have_liked.css({top:position_y,left:position_x})}},".likes, .shortcakes")}),$("#stream").on("keyup paste",".size-adjust",function(){var e=$(this),s=e.innerHeight()-e.height();e.innerHeight()<this.scrollHeight?e.height(this.scrollHeight-s):(e.height(1),e.height(this.scrollHeight-s))});