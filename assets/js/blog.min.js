function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var a=document.createElement("div");return a.innerHTML=e,a.textContent||a.innerText||""}$(function(){var e=firebase.database().ref().child(slugify(window.location.pathname)),a=$("#error--no-name"),s=$("#error--no-message"),t=$(".popup-container"),r="anonymous";firebase.database().ref().child("postComments");e.on("child_added",function(e){var a=e.val(),s=escapeHtml(a.name),t=escapeHtml(a.message),r=moment(a.postedAt).fromNow(),i=e.key,n=a.reply_to,l=a.indent,d=a.likes,c=a.likers,o=a.cakes,p=a.cakers,m=15*l,h="$(this).toggleClass('active').parent().next().toggleClass('hidden')";0==n?$(".comments").prepend('<div id="'+i+'" class="comment" data-indent="0"><div class="message-container"><h4>'+s+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+r+'</p><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div><span class="likes">'+d+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div><a href="#stream" class="reply-to" onclick="'+h+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="reply-message" placeholder="Write a response"></textarea><input class="btn" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>'):$("#"+n).find(".responses").first().append('<div id="'+i+'" class="comment reply" data-indent="'+l+'" style="padding-left:'+m+'px" data-likes="0"><div class="message-container"><h4>'+s+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+r+'</p><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div><span class="likes">'+d+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div><a href="#stream" class="reply-to" onclick="'+h+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="reply-message" placeholder="Write a response"></textarea><input class="btn" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>')}),e.on("child_changed",function(e){var a=e.val(),s=a.likes,t=a.likers,r=$("#"+e.key),i=a.cakes,n=a.cakers;r.find(".likes").first().html(s),r.find(".ppl-who-have-liked.like-reacts").html(t),r.find(".shortcakes").first().html(i),r.find(".ppl-who-have-liked.cake-reacts").html(n)}),$("#join-chat").click(function(){t.addClass("active")}),$("#submit-name").click(function(){if(!((r=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),t.append('<p class="center-hor-ver">hi '+r+"</p>"),setTimeout(function(){t.removeClass("active"),$(".comments").addClass("active"),$(".comment-form--container").removeClass("hidden")},500),r;a.removeClass("hidden")}),$("#chat-name").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#submit-name").click())}),$("#comment").submit(function(a){a.preventDefault();var t=$("#message").val();if(!(t.length<=0))return e.push().set({name:r,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:!1,indent:0}),$("input[type=text], textarea").val(""),!1;s.removeClass("hidden")}),$("#message").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$(document).on("submit",'form[name="reply"]',function(){var a=$(this).find(".reply-message").val(),s=$(this).parents(".comment"),t=s.attr("id"),i=$(this).find("#error--no-reply"),n=parseInt(s.data("indent"))+1;if(!(a.length<=0))return e.push().set({name:r,message:a,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:t,indent:n}),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1;i.removeClass("hidden")}),$("#message").on("keyup",function(){s.hasClass("hidden")||s.addClass("hidden")}),$(document).on("keyup",".reply-message",function(){$error=$(this).parent().find("#error--no-reply"),$error.hasClass("hidden")||$error.addClass("hidden")}),$(document).on("click",".like",function(a){var s=$(a.target);if(!s.hasClass("clicked")){var t=s.parents(".comment"),i=t.attr("id"),n=e.child(i),l=parseInt(s.prev().html()),d=t.find(".ppl-who-have-liked.like-reacts").html()+"<br>"+r;return n&&(n.update({likes:l+1,likers:d}),s.addClass("clicked")),n}}),$(document).on("click",".shortcake",function(a){var s=$(a.target);if(!s.hasClass("clicked")){var t=s.parents(".comment"),i=t.attr("id"),n=e.child(i),l=parseInt(s.prev().html()),d=t.find(".ppl-who-have-liked.cake-reacts").html()+"<br>"+r;return n&&(n.update({cakes:l+1,cakers:d}),s.addClass("clicked")),n}})});