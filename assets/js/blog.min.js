function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var s=document.createElement("div");return s.innerHTML=e,s.textContent||s.innerText||""}$(function(){var e=firebase.database().ref().child(slugify(window.location.pathname)),s=$("#error--no-name"),a=$("#error--no-message"),t=$(".popup-container"),i=$("#comments"),r="anonymous";e.on("child_added",function(e){var s=e.val(),a=escapeHtml(s.name),t=escapeHtml(s.message),r=moment(s.postedAt).fromNow(),n=e.key,l=s.reply_to,c=s.likes,d=s.likers,o=s.cakes,p=s.cakers,h=s.reply_name,m="$(this).toggleClass('active').parent().next().toggleClass('hidden')";0==l?i.prepend('<div id="'+n+'" class="comment"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+r+'</p><div class="cake-container"><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div></div><div class="likes-container"><span class="likes">'+c+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+d+'</div></div><a href="#stream" class="reply-to" onclick="'+m+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn hidden" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>'):$("#"+l).find(".responses").first().append('<div id="'+n+'" class="comment reply" data-replyto="'+h+'"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+r+'</p><div class="cake-container"><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div></div><div class="likes-container"><span class="likes">'+c+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+d+'</div></div><a href="#stream" class="reply-to" onclick="'+m+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn hidden" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>')}),e.on("child_changed",function(e){var s=e.val(),a=s.likes,t=s.likers,i=$("#"+e.key),r=s.cakes,n=s.cakers,l=s.reply_name;i.find(".likes").first().html(a),i.find(".ppl-who-have-liked.like-reacts").first().html(t),i.find(".shortcakes").first().html(r),i.find(".ppl-who-have-liked.cake-reacts").first().html(n),i.data("replyto-name",l)}),$("#stream").on("click",function(e){var a=$(e.target).attr("id");if("join-chat"==a)t.addClass("active");else{if("submit-name"!=a)return!1;if(!((r=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),t.append('<p class="center-hor-ver">hi '+r+"</p>"),setTimeout(function(){t.removeClass("active"),i.addClass("active"),$(".comment-form--container").removeClass("hidden")},500),r;s.removeClass("hidden")}}),$("#chat-name").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#submit-name").click())}),$("#comment").submit(function(s){s.preventDefault();var t=$("#message").val();if(!(t.length<=0))return e.push().set({name:r,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:!1,reply_name:""}),$("input[type=text], textarea").val(""),!1;a.removeClass("hidden")}),$("#message").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("keyup",".reply-message",function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("submit",'form[name="reply"]',function(){var s=$(this).find(".reply-message").val(),a=$(this).parents(".comment").first(),t=a.attr("id"),i=a.find("h4").text().split(":")[0],n=$(this).find("#error--no-reply");if(!(s.length<=0))return e.push().set({name:r,message:s,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:t,reply_name:"Replying to: "+i}),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1;n.removeClass("hidden")}),$("#message").on("keyup",function(){a.hasClass("hidden")||a.addClass("hidden")}),$("#stream").on("keyup",".reply-message",function(){$error=$(this).parent().find("#error--no-reply"),$error.hasClass("hidden")||$error.addClass("hidden")}),$("#stream").on("click",".like",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),i=t.attr("id"),n=e.child(i),l=parseInt(a.prev().html()),c=t.find(".ppl-who-have-liked.like-reacts").html()+"<br>"+r;return n&&(n.update({likes:l+1,likers:c}),a.addClass("clicked")),n}}),$("#stream").on("click",".shortcake",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),i=t.attr("id"),n=e.child(i),l=parseInt(a.prev().html()),c=t.find(".ppl-who-have-liked.cake-reacts").html()+"<br>"+r;return n&&(n.update({cakes:l+1,cakers:c}),a.addClass("clicked")),n}}),$("#stream").on({mouseenter:function(e){ppl_who_have_liked=$(e.currentTarget).next().next(),position_y=e.clientY,position_x=e.clientX,ppl_who_have_liked.css({top:position_y,left:position_x})}},".likes, .shortcakes")}),$("#stream").on("keyup paste",".size-adjust",function(){var e=$(this),s=e.innerHeight()-e.height();e.innerHeight()<this.scrollHeight?e.height(this.scrollHeight-s):(e.height(1),e.height(this.scrollHeight-s))});