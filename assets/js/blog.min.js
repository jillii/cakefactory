function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var a=document.createElement("div");return a.innerHTML=e,a.textContent||a.innerText||""}$(function(){var e=firebase.database().ref().child(slugify(window.location.pathname)),a=$("#error--no-name"),s=$("#error--no-message"),t=$(".popup-container"),i=$("#comments"),r="anonymous";e.on("child_added",function(e){var a=e.val(),s=escapeHtml(a.name),t=escapeHtml(a.message),r=moment(a.postedAt).fromNow(),n=e.key,l=a.reply_to,d=a.likes,c=a.likers,o=a.cakes,h=a.cakers,p=a.reply_name,m=$(document.createElement("div"));0==l?i.prepend(m):($("#"+l).find(".responses").first().append(m),m.addClass("reply")),m.html('<div id="'+n+'" class="comment" data-replyto="'+p+'"data-likes="'+d+'" data-cakes="'+o+'" data-name="'+s+'"><div class="message-container"><h4>'+s+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+r+'</p><div class="cake-container"><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+h+'</div></div><div class="likes-container"><span class="likes">'+d+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div></div><a href="#stream" class="reply-to" onclick="$(this).toggleClass(\'active\').parent().next().toggleClass(\'hidden\')">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn hidden" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>')}),e.on("child_changed",function(e){var a=e.val(),s=a.likes,t=a.likers,i=$("#"+e.key),r=a.cakes,n=a.cakers,l=a.reply_name;i.find(".likes").first().html(s),i.find(".ppl-who-have-liked.like-reacts").first().html(t),i.data("likes",s),i.find(".shortcakes").first().html(r),i.find(".ppl-who-have-liked.cake-reacts").first().html(n),i.data("cakes",r),i.data("replyto-name",l)}),$("#stream").on("click","#join-chat",function(){t.addClass("active")}),$("#stream").on("click","#submit-name",function(e){if(!((r=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),t.html('<p class="center-hor-ver">hi '+r+"</p>"),setTimeout(function(){t.removeClass("active"),i.addClass("active"),$(".comment-form--container").removeClass("hidden")},500),r;a.removeClass("hidden")}),$("#chat-name").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#submit-name").click())}),$("#comment").submit(function(a){a.preventDefault();var t=$("#message").val();if(!(t.length<=0))return e.push().set({name:r,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:!1,reply_name:""}),$("input[type=text], textarea").val(""),!1;s.removeClass("hidden")}),$("#message").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("keyup",".reply-message",function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$("#stream").on("submit",'form[name="reply"]',function(a){var s=$(this),t=s.find(".reply-message").val(),i=s.parents(".comment").first(),n=i.attr("id"),l=i.data("name");if(!(t.length<=0))return e.push().set({name:r,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:n,reply_name:"Replying to: "+l}),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1;s.find("#error--no-reply").removeClass("hidden")}),$("#message").on("keyup",function(){s.hasClass("hidden")||s.addClass("hidden")}),$("#stream").on("keyup",".reply-message",function(){$error=$(this).parent().find("#error--no-reply"),$error.hasClass("hidden")||$error.addClass("hidden")}),$("#stream").on("click",".like",function(a){var s=$(a.target);if(!s.hasClass("clicked")){var t=s.parents(".comment"),i=t.attr("id"),n=e.child(i),l=t.data("likes");if(0!=l)var d=t.find(".ppl-who-have-liked.like-reacts").html()+"<br>"+r;else d=r;return n&&(n.update({likes:l+1,likers:d}),s.addClass("clicked")),n}}),$("#stream").on("click",".shortcake",function(a){var s=$(a.target);if(!s.hasClass("clicked")){var t=s.parents(".comment"),i=t.attr("id"),n=e.child(i),l=t.data("cakes");return likers_data=0!=l?t.find(".ppl-who-have-liked.cake-reacts").html()+"<br>"+r:r,n&&(n.update({cakes:l+1,cakers:likers_data}),s.addClass("clicked")),n}}),$("#stream").on({mouseenter:function(e){var a=$(e.currentTarget),s=a.next().next();if(s.hasClass("hidden")&&s.removeClass("hidden"),0!=a.html()){var t=e.clientY,i=e.clientX;s.css({top:t,left:i})}else s.addClass("hidden")}},".likes, .shortcakes")}),$("#stream").on("keyup paste",".size-adjust",function(){var e=$(this),a=e.innerHeight()-e.height();e.innerHeight()<this.scrollHeight?e.height(this.scrollHeight-a):(e.height(1),e.height(this.scrollHeight-a))}),$("iframe").on("load",function(){console.log($(this)[0].contentWindow)});