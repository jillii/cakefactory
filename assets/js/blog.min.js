function slugify(e){return e.toString().toLowerCase().trim().replace(/&/g,"-and-").replace(/[\s\W-]+/g,"-").replace(/[^a-zA-Z0-9-_]+/g,"")}function escapeHtml(e){var s=document.createElement("div");return s.innerHTML=e,s.textContent||s.innerText||""}$(function(){var e=firebase.database().ref().child(slugify(window.location.pathname)),s=$("#error--no-name"),a=$("#error--no-message"),t=$(".popup-container"),i="anonymous";firebase.database().ref().child("postComments");e.on("child_added",function(e){var s=e.val(),a=escapeHtml(s.name),t=escapeHtml(s.message),i=moment(s.postedAt).fromNow(),n=e.key,r=s.reply_to,l=s.indent,d=s.likes,c=s.likers,o=s.cakes,p=s.cakers,h=15*l,m="$(this).toggleClass('active').parent().next().toggleClass('hidden')";0==r?$(".comments").prepend('<div id="'+n+'" class="comment" data-indent="0"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+i+'</p><div class="cake-container"><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div></div><div class="likes-container"><span class="likes">'+d+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div></div><a href="#stream" class="reply-to" onclick="'+m+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>'):$("#"+r).find(".responses").first().append('<div id="'+n+'" class="comment reply" data-indent="'+l+'" style="padding-left:'+h+'px" data-likes="0"><div class="message-container"><h4>'+a+":</h4><span>&nbsp;"+t+'</span></div><div class="actions"><p class="date">'+i+'</p><div class="cake-container"><span class="shortcakes">'+o+'</span><a href="#stream" class="shortcake"></a><div class="ppl-who-have-liked cake-reacts">'+p+'</div></div><div class="likes-container"><span class="likes">'+d+'</span><a href="#stream" class="like"></a><div class="ppl-who-have-liked like-reacts">'+c+'</div></div><a href="#stream" class="reply-to" onclick="'+m+'">reply</a></div><div class="drawer hidden"><form name="reply"><textarea rows="1" class="size-adjust reply-message" placeholder="Write a response"></textarea><input class="btn" type="submit" value="Reply"><div class="error hidden" id="error--no-reply">Please write a message</div></form></div><div class="responses"></div></div>')}),e.on("child_changed",function(e){var s=e.val(),a=s.likes,t=s.likers,i=$("#"+e.key),n=s.cakes,r=s.cakers;i.find(".likes").first().html(a),i.find(".ppl-who-have-liked.like-reacts").html(t),i.find(".shortcakes").first().html(n),i.find(".ppl-who-have-liked.cake-reacts").html(r)}),$("#join-chat").click(function(){t.addClass("active")}),$("#submit-name").click(function(){if(!((i=$("#chat-name").val()).length<=0))return $("#join-chat, .popup").addClass("hidden"),t.append('<p class="center-hor-ver">hi '+i+"</p>"),setTimeout(function(){t.removeClass("active"),$(".comments").addClass("active"),$(".comment-form--container").removeClass("hidden")},500),i;s.removeClass("hidden")}),$("#chat-name").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$("#submit-name").click())}),$("#comment").submit(function(s){s.preventDefault();var t=$("#message").val();if(!(t.length<=0))return e.push().set({name:i,message:t,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:!1,indent:0}),$("input[type=text], textarea").val(""),!1;a.removeClass("hidden")}),$("#message").keyup(function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$(document).on("keyup",".reply-message",function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),$(this).next().click())}),$(document).on("submit",'form[name="reply"]',function(){var s=$(this).find(".reply-message").val(),a=$(this).parents(".comment"),t=a.attr("id"),n=$(this).find("#error--no-reply"),r=parseInt(a.data("indent"))+1;if(!(s.length<=0))return e.push().set({name:i,message:s,postedAt:firebase.database.ServerValue.TIMESTAMP,likes:0,likers:"",cakes:0,cakers:"",reply_to:t,indent:r}),$("input[type=text], textarea").val(""),$(this).parent().addClass("hidden"),$(".reply-to.active").removeClass("active"),!1;n.removeClass("hidden")}),$("#message").on("keyup",function(){a.hasClass("hidden")||a.addClass("hidden")}),$(document).on("keyup",".reply-message",function(){$error=$(this).parent().find("#error--no-reply"),$error.hasClass("hidden")||$error.addClass("hidden")}),$(document).on("click",".like",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),n=t.attr("id"),r=e.child(n),l=parseInt(a.prev().html()),d=t.find(".ppl-who-have-liked.like-reacts").html()+"<br>"+i;return r&&(r.update({likes:l+1,likers:d}),a.addClass("clicked")),r}}),$(document).on("click",".shortcake",function(s){var a=$(s.target);if(!a.hasClass("clicked")){var t=a.parents(".comment"),n=t.attr("id"),r=e.child(n),l=parseInt(a.prev().html()),d=t.find(".ppl-who-have-liked.cake-reacts").html()+"<br>"+i;return r&&(r.update({cakes:l+1,cakers:d}),a.addClass("clicked")),r}})}),$(document).on("keyup paste",".size-adjust",function(){var e=$(this),s=e.innerHeight()-e.height();e.innerHeight()<this.scrollHeight?e.height(this.scrollHeight-s):(e.height(1),e.height(this.scrollHeight-s))});